<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="jatek1.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Menza</title>
    <style>
      @import url("https://fonts.cdnfonts.com/css/thegoodmonolith");
    </style>
  </head>
  <body>
    <nav id="navelh" class="navbar navbar-expand-sm bg-dark navbar-dark">
      <div class="container-fluid">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link active" href="index.html">Főoldal</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="menza.html">Menza</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="jatek-eloszto.html">Játék</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="frame">
      <div class="camera">
        <div class="map pixel-art">
          <div class="character" facing="down" walking="true">
            <div class="shadow pixel-art"></div>
            <div class="character_spritesheet pixel-art"></div>
          </div>
        </div>
      </div>
    </div>

    <button id="kezdes" onclick="kezdes()">Kezdés</button>

    <div id="kezdes2" class="utasitas">A nyilak mozgatásával tudsz haladni</div>
    <div id="beszed1">
      A játékban három fontos feladatod van: <br />
      Elvedd a tálcádat, ülj le egy asztalnál és fogyaszd ez az ételedet.
    </div>
    <div id="beszed2">
      Elvetted a tálcádat. <br />
      Most ülj le a lehető legtávolabb!
    </div>
    <div id="beszed3">Remélem jól laktál!</div>
    <div id="beszed4">Köszönöm a játékot!</div>
    <script>
      function kezdes() {
        var mapElement = document.querySelector(".map");
        mapElement.style.visibility = "visible";
        var mapElement = document.querySelector(".camera");
        mapElement.style.visibility = "visible";
        var mapElement = document.querySelector(".frame");
        mapElement.style.visibility = "visible";
        var mapElement = document.querySelector(".character");
        mapElement.style.visibility = "visible";
        var mapElement = document.querySelector(".shadow");
        mapElement.style.visibility = "visible";

        var mapElement = document.querySelector("#kezdes");
        mapElement.style.visibility = "hidden";
        var mapElement = document.querySelector("#kezdes2");
        mapElement.style.visibility = "hidden";

        var mapElement = document.querySelector("#beszed1");
        mapElement.style.visibility = "visible";

        var character = document.querySelector(".character");
        var map = document.querySelector(".map");

        var x = 144;
        var y = 340;
        var held_directions = [];
        var speed = 1;

        const placeCharacter = () => {
          var pixelSize = parseInt(
            getComputedStyle(document.documentElement).getPropertyValue(
              "--pixel-size"
            )
          );

          const held_direction = held_directions[0];
          if (held_direction) {
            var mapElement = document.querySelector("#beszed1");
            mapElement.style.visibility = "hidden";
            if (held_direction === directions.right) {
              x += speed;
            }
            if (held_direction === directions.left) {
              x -= speed;
            }
            if (held_direction === directions.down) {
              y += speed;
            }
            if (held_direction === directions.up) {
              y -= speed;
            }
            character.setAttribute("facing", held_direction);
          }
          character.setAttribute("walking", held_direction ? "true" : "false");

          var leftLimit = 7;
          var rightLimit = 16 * 17 - 7;
          var topLimit = 60;
          var bottomLimit = 16 * 19 - 15;
          if (x < leftLimit) {
            x = leftLimit;
          }
          if (x > rightLimit) {
            x = rightLimit;
          }
          if (y < topLimit) {
            y = topLimit;
          }
          if (y > bottomLimit) {
            y = bottomLimit;
          }

          var characterWidth = pixelSize * 4;
          var characterHeight = pixelSize * 4;

          var boulderX1 = 198;
          var boulderY1 = 85;
          var boulderWidth1 = 10;
          var boulderHeight1 = 10;

          if (
            x < boulderX1 + boulderWidth1 &&
            x + characterWidth > boulderX1 &&
            y < boulderY1 + boulderHeight1 &&
            y + characterHeight > boulderY1
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }
          var boulderX2 = 97;
          var boulderY2 = 85;
          var boulderWidth2 = 10;
          var boulderHeight2 = 10;

          if (
            x < boulderX2 + boulderWidth2 &&
            x + characterWidth > boulderX2 &&
            y < boulderY2 + boulderHeight2 &&
            y + characterHeight > boulderY2
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }
          var boulderX3 = 64;
          var boulderY3 = 223;
          var boulderWidth3 = 24;
          var boulderHeight3 = 24;

          if (
            x < boulderX3 + boulderWidth3 &&
            x + characterWidth > boulderX3 &&
            y < boulderY3 + boulderHeight3 &&
            y + characterHeight > boulderY3
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }
          var boulderX4 = 64;
          var boulderY4 = 156;
          var boulderWidth4 = 24;
          var boulderHeight4 = 24;

          if (
            x < boulderX4 + boulderWidth4 &&
            x + characterWidth > boulderX4 &&
            y < boulderY4 + boulderHeight4 &&
            y + characterHeight > boulderY4
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }
          var boulderX5 = 199;
          var boulderY5 = 156;
          var boulderWidth5 = 24;
          var boulderHeight5 = 24;

          if (
            x < boulderX5 + boulderWidth5 &&
            x + characterWidth > boulderX5 &&
            y < boulderY5 + boulderHeight5 &&
            y + characterHeight > boulderY5
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }
          var boulderX6 = 199;
          var boulderY6 = 223;
          var boulderWidth6 = 24;
          var boulderHeight6 = 24;

          if (
            x < boulderX6 + boulderWidth6 &&
            x + characterWidth > boulderX6 &&
            y < boulderY6 + boulderHeight6 &&
            y + characterHeight > boulderY6
          ) {
            if (held_direction === directions.right) {
              x -= speed;
            }
            if (held_direction === directions.left) {
              x += speed;
            }
            if (held_direction === directions.down) {
              y -= speed;
            }
            if (held_direction === directions.up) {
              y += speed;
            }
          }

          //  szoveg

          var boulderX7 = 280;
          var boulderY7 = 120;
          var boulderWidth7 = 10;
          var boulderHeight7 = 100;

          if (
            x < boulderX7 + boulderWidth7 &&
            x + characterWidth > boulderX7 &&
            y < boulderY7 + boulderHeight7 &&
            y + characterHeight > boulderY7
          ) {
            if (held_direction === directions.right) {
              var mapElement = document.querySelector("#beszed2");
              mapElement.style.visibility = "visible";
            }
          }

          var boulderX8 = 63;
          var boulderY8 = 156;
          var boulderWidth8 = 1;
          var boulderHeight8 = 24;

          if (
            x < boulderX8 + boulderWidth8 &&
            x + characterWidth > boulderX8 &&
            y < boulderY8 + boulderHeight8 &&
            y + characterHeight > boulderY8
          ) {
            if (held_direction === directions.right) {
              var mapElement = document.querySelector("#beszed2");
              mapElement.style.visibility = "hidden";
              var mapElement = document.querySelector("#beszed3");
              mapElement.style.visibility = "visible";
              setTimeout(function () {
                var mapElement = document.querySelector(".map");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".camera");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".frame");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".character");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".shadow");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector("#beszed3");
              mapElement.style.border = "none";
              }, 2000);
              setTimeout(function () {
                var mapElement = document.querySelector("#beszed3");
              mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector("#beszed4");
              mapElement.style.visibility = "visible";
              }, 4000);
            }
          }

          var boulderX9 = 62;
          var boulderY9 = 51;
          var boulderWidth9 = 10;
          var boulderHeight9 = 10;

          if (
            x < boulderX9 + boulderWidth9 &&
            x + characterWidth > boulderX9 &&
            y < boulderY9 + boulderHeight9 &&
            y + characterHeight > boulderY9
          ) {
          if (held_direction === directions.up) {
              var mapElement = document.querySelector("#beszed2");
              mapElement.style.visibility = "hidden";
              var mapElement = document.querySelector("#beszed3");
              mapElement.style.visibility = "visible";
              setTimeout(function () {
                var mapElement = document.querySelector(".map");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".camera");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".frame");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".character");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector(".shadow");
                mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector("#beszed3");
              mapElement.style.border = "none";
              }, 2000);
              setTimeout(function () {
                var mapElement = document.querySelector("#beszed3");
              mapElement.style.visibility = "hidden";
                var mapElement = document.querySelector("#beszed4");
              mapElement.style.visibility = "visible";
              }, 4000);
            }
          }

          var camera_left = pixelSize * 66;
          var camera_top = pixelSize * 42;

          map.style.transform = `translate3d( ${
            -x * pixelSize + camera_left
          }px, ${-y * pixelSize + camera_top}px, 0 )`;
          character.style.transform = `translate3d( ${x * pixelSize}px, ${
            y * pixelSize
          }px, 0 )`;
        };

        const step = () => {
          placeCharacter();
          window.requestAnimationFrame(() => {
            step();
          });
        };
        step();

        const directions = {
          up: "up",
          down: "down",
          left: "left",
          right: "right",
        };
        const keys = {
          38: directions.up,
          37: directions.left,
          39: directions.right,
          40: directions.down,
        };
        document.addEventListener("keydown", (e) => {
          var dir = keys[e.which];
          if (dir && held_directions.indexOf(dir) === -1) {
            held_directions.unshift(dir);
          }
        });

        document.addEventListener("keyup", (e) => {
          var dir = keys[e.which];
          var index = held_directions.indexOf(dir);
          if (index > -1) {
            held_directions.splice(index, 1);
          }
        });
      }
    </script>
  </body>
</html>
