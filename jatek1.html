<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="etelkeszito.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Menza</title>
    <script src="etelkeszito.js"></script>
  </head>
  <body>
    <div class="frame">
      <div class="camera">
        <div class="map pixel-art">
          <div class="character" facing="down" walking="true">
            <div class="shadow pixel-art"></div>
            <div class="character_spritesheet pixel-art"></div>
          </div>
        </div>
      </div>
    </div>
    <script>
      var character = document.querySelector(".character");
      var map = document.querySelector(".map");

      
      var x = 144;
      var y = 340;
      var held_directions = []; 
      var speed = 1; 

      const placeCharacter = () => {
        var pixelSize = parseInt(
          getComputedStyle(document.documentElement).getPropertyValue(
            "--pixel-size"
          )
        );

        const held_direction = held_directions[0];
        if (held_direction) {
          if (held_direction === directions.right) {
            x += speed;
          }
          if (held_direction === directions.left) {
            x -= speed;
          }
          if (held_direction === directions.down) {
            y += speed;
          }
          if (held_direction === directions.up) {
            y -= speed;
          }
          character.setAttribute("facing", held_direction);
        }
        character.setAttribute("walking", held_direction ? "true" : "false");

        
        var leftLimit = 7;
        var rightLimit = 16 * 17-7;
        var topLimit = 60;
        var bottomLimit = 16 * 19-15;
        if (x < leftLimit) {
          x = leftLimit;
        }
        if (x > rightLimit) {
          x = rightLimit;
        }
        if (y < topLimit) {
          y = topLimit;
        }
        if (y > bottomLimit) {
          y = bottomLimit;
        }

        var camera_left = pixelSize * 66;
        var camera_top = pixelSize * 42;

        map.style.transform = `translate3d( ${
          -x * pixelSize + camera_left
        }px, ${-y * pixelSize + camera_top}px, 0 )`;
        character.style.transform = `translate3d( ${x * pixelSize}px, ${
          y * pixelSize
        }px, 0 )`;
      };

     
      const step = () => {
        placeCharacter();
        window.requestAnimationFrame(() => {
          step();
        });
      };
      step(); 

     
      const directions = {
        up: "up",
        down: "down",
        left: "left",
        right: "right",
      };
      const keys = {
        38: directions.up,
        37: directions.left,
        39: directions.right,
        40: directions.down,
      };
      document.addEventListener("keydown", (e) => {
        var dir = keys[e.which];
        if (dir && held_directions.indexOf(dir) === -1) {
          held_directions.unshift(dir);
        }
      });

      document.addEventListener("keyup", (e) => {
        var dir = keys[e.which];
        var index = held_directions.indexOf(dir);
        if (index > -1) {
          held_directions.splice(index, 1);
        }
      });
    </script>
  </body>
</html>
